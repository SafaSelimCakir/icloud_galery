<form id="uploadForm" enctype="multipart/form-data">
  <input type="file" name="file" required>
  <button type="submit">Yükle</button>
</form>

<form id="deleteForm" method="post">
  {% csrf_token %}
  <div style="display: flex; flex-wrap: wrap;">
    {% for item in media %}
      <div style="margin: 10px;">
        <input type="checkbox" name="media_ids" value="{{ item.icloud_id }}">
        <img src="{{ item.thumbnail_url }}" width="150">
        <p>{{ item.file_name }}</p>
      </div>
    {% endfor %}
  </div>
  <button type="submit">Seçilenleri Sil</button>
</form>

<script>
  document.getElementById('uploadForm').onsubmit = async function (e) {
    e.preventDefault();
    const formData = new FormData(this);
    const res = await fetch("{% url 'upload_media' %}", {
      method: 'POST',
      body: formData,
      headers: { 'X-CSRFToken': '{{ csrf_token }}' }
    });
    location.reload();
  };

  document.getElementById('deleteForm').onsubmit = async function (e) {
    e.preventDefault();
    const checkboxes = document.querySelectorAll('input[name="media_ids"]:checked');
    const formData = new FormData();
    checkboxes.forEach(cb => formData.append('media_ids[]', cb.value));

    const res = await fetch("{% url 'delete_selected_media' %}", {
      method: 'POST',
      body: formData,
      headers: { 'X-CSRFToken': '{{ csrf_token }}' }
    });
    location.reload();
  };
</script>
